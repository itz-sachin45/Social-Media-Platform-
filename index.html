 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Social Demo ‚Ä¢ Canva Code</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#eff6ff',
              100: '#dbeafe',
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a',
            },
            accent: {
              500: '#f59e0b'
            }
          },
          boxShadow: {
            soft: '0 1px 2px rgba(0,0,0,0.06), 0 8px 24px rgba(0,0,0,0.08)'
          }
        }
      }
    }
  </script>
  <style>
    .fade-in { animation: fadeIn .22s ease-out; }
    .slide-up { animation: slideUp .22s ease-out; }
    @keyframes fadeIn { from {opacity:0} to {opacity:1} }
    @keyframes slideUp { from {transform:translateY(10px); opacity:0} to {transform:translateY(0); opacity:1} }
    .clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;  
      overflow: hidden;
    }
    .btn { @apply px-4 py-2 rounded-xl transition; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-50 via-indigo-50 to-fuchsia-50 text-slate-800">
  <!-- Demo notice -->
  <div class="w-full bg-gradient-to-r from-brand-700 via-brand-600 to-brand-700 text-white text-sm">
    <div class="max-w-6xl mx-auto px-4 py-2 flex items-center justify-center gap-2">
      <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-white/15">üí¨</span>
      <p class="opacity-95">Demo social app ‚Äî no real backend. Login is not available in Canva Code.</p>
    </div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-50 backdrop-blur bg-white/70 shadow-sm">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex items-center justify-between py-3 md:py-4 gap-3">
        <a href="#feed" class="flex items-center gap-3 group">
          <span class="p-2 rounded-xl bg-brand-100 text-brand-700 shadow-soft group-hover:scale-105 transition">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M4 5a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v1h3a2 2 0 0 1 2 2v9.5A2.5 2.5 0 0 1 17.5 20H6.5A2.5 2.5 0 0 1 4 17.5V5zM15 6V5a1 1 0 0 0-1-1H6a1 1 0 0 0-1 1v12.5c0 .83.67 1.5 1.5 1.5h11c.83 0 1.5-.67 1.5-1.5V8a1 1 0 0 0-1-1h-3z"/>
            </svg>
          </span>
          <div>
            <div class="text-lg font-bold tracking-tight">Chatter Demo</div>
            <div class="text-xs text-slate-500 -mt-0.5">by Canva Code</div>
          </div>
        </a>

        <nav class="hidden md:flex items-center gap-1">
          <a href="#feed" class="px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700">Feed</a>
          <a href="#explore" class="px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700">Explore</a>
          <a href="#users" class="px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700">Users</a>
          <a href="#profile" class="px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700">Profile</a>
        </nav>

        <div class="hidden md:flex items-center gap-3">
          <div class="flex items-center gap-2 rounded-xl bg-white border border-slate-200 shadow-soft px-3 py-2">
            <span>üë§</span>
            <select id="activeUserSelect" class="bg-transparent outline-none"></select>
          </div>
          <button id="openComposer" class="px-4 py-2 rounded-xl bg-brand-600 text-white hover:bg-brand-700">New Post</button>
        </div>

        <button id="mobileMenuBtn" class="md:hidden px-3 py-2 rounded-lg bg-white border border-slate-200 hover:bg-slate-50">‚ò∞</button>
      </div>

      <!-- Mobile bar -->
      <div id="mobileMenu" class="hidden md:hidden pb-3 border-t border-slate-200">
        <div class="pt-3 flex flex-col gap-2">
          <div class="flex items-center gap-2 rounded-xl bg-white border border-slate-200 shadow-soft px-3 py-2">
            <span>üë§</span>
            <select id="activeUserSelectMobile" class="bg-transparent outline-none flex-1"></select>
          </div>
          <a href="#feed" class="px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700">Feed</a>
          <a href="#explore" class="px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700">Explore</a>
          <a href="#users" class="px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700">Users</a>
          <a href="#profile" class="px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700">Profile</a>
          <button id="openComposerMobile" class="px-3 py-2 rounded-lg bg-brand-600 text-white hover:bg-brand-700">New Post</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Content -->
  <main class="max-w-6xl mx-auto px-4 py-8 grid gap-8">
    <!-- Feed -->
    <section id="page-feed" class="grid md:grid-cols-[1.2fr,0.8fr] gap-6">
      <div class="grid gap-4">
        <div class="rounded-2xl bg-white shadow-soft p-3 md:p-4 sticky top-20 z-10">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <div class="flex items-center gap-2 rounded-xl bg-white border border-slate-200 shadow-soft px-3 py-2 w-full md:w-96">
              <span>üîé</span>
              <input id="feedSearch" placeholder="Search your feed..." class="w-full outline-none bg-transparent" />
            </div>
            <div class="flex items-center gap-2">
              <select id="feedFilter" class="rounded-xl border border-slate-300 px-3 py-2 bg-white">
                <option value="all">All</option>
                <option value="following">Following</option>
                <option value="me">My posts</option>
                <option value="liked">Liked</option>
              </select>
              <select id="feedSort" class="rounded-xl border border-slate-300 px-3 py-2 bg-white">
                <option value="latest">Latest</option>
                <option value="top">Top (likes)</option>
              </select>
            </div>
          </div>
        </div>
        <div id="feedList" class="grid gap-3 md:gap-4"></div>
      </div>
      <aside class="grid gap-4 h-fit md:sticky md:top-24">
        <div class="rounded-2xl bg-white shadow-soft p-5">
          <div class="font-semibold">Who to follow</div>
          <div id="suggestList" class="mt-3 grid gap-3"></div>
        </div>
        <div class="rounded-2xl bg-white shadow-soft p-5">
          <div class="font-semibold">Trends</div>
          <ul class="mt-3 text-sm text-slate-600 space-y-2">
            <li>#DesignTools</li>
            <li>#OpenWeb</li>
            <li>#Frontend</li>
          </ul>
        </div>
      </aside>
    </section>

    <!-- Explore -->
    <section id="page-explore" class="hidden">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
        <h2 class="text-2xl font-bold">Explore</h2>
        <div class="flex items-center gap-2 rounded-xl bg-white border border-slate-200 shadow-soft px-3 py-2 w-full md:w-96">
          <span>üîé</span>
          <input id="exploreSearch" placeholder="Search posts or users..." class="w-full outline-none bg-transparent" />
        </div>
      </div>
      <div id="exploreList" class="mt-4 grid gap-3 md:gap-4"></div>
    </section>

    <!-- Users -->
    <section id="page-users" class="hidden">
      <h2 class="text-2xl font-bold">People</h2>
      <div id="usersList" class="mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4"></div>
    </section>

    <!-- Profile -->
    <section id="page-profile" class="hidden">
      <div id="profileHeader" class="rounded-2xl overflow-hidden shadow-soft bg-white"></div>
      <div id="profilePosts" class="mt-4 grid gap-4"></div>
    </section>

    <!-- Post details -->
    <section id="page-post" class="hidden">
      <div id="postDetails" class="grid gap-4"></div>
    </section>
  </main>

  <!-- Composer Modal -->
  <div id="composerModal" class="hidden fixed inset-0 z-[60] bg-black/40 flex items-center justify-center p-4">
    <div class="relative w-full max-w-xl rounded-2xl bg-white shadow-soft p-5 slide-up">
      <button id="closeComposer" class="absolute top-3 right-3 p-2 rounded-full hover:bg-slate-100" aria-label="Close">‚úï</button>
      <h3 class="text-lg font-bold">Create a post</h3>
      <form id="composerForm" class="mt-3 grid gap-3">
        <textarea id="composerText" rows="4" maxlength="280" class="w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-500" placeholder="What's happening?"></textarea>
        <div class="flex items-center justify-between">
          <div class="text-xs text-slate-500"><span id="charCount">0</span>/280</div>
          <button type="submit" class="px-4 py-2 rounded-xl bg-brand-600 text-white hover:bg-brand-700">Post</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toasts -->
  <div id="toastWrap" class="fixed top-4 right-4 z-[70] space-y-2"></div>

  <footer class="mt-2 pb-10">
    <div class="max-w-6xl mx-auto px-4">
      <div class="rounded-2xl bg-white shadow-soft p-6 md:p-8 flex flex-col md:flex-row items-center justify-between gap-4">
        <p class="text-slate-600">Demo-only social platform. Data saves to your browser.</p>
        <a href="#explore" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-accent-500 text-white hover:opacity-90">Explore ‚Üí</a>
      </div>
    </div>
  </footer>

  <script>
    // -------------- Storage Keys --------------
    const USERS_KEY = 'cc_social_users_v1';
    const POSTS_KEY = 'cc_social_posts_v1';
    const ACTIVE_USER_KEY = 'cc_social_active_user_v1';

    // -------------- Helpers --------------
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);
    const nowISO = () => new Date().toISOString();
    const genId = (p='ID') => p + '-' + Math.random().toString(36).slice(2,8) + '-' + Date.now().toString(36);
    const toast = (msg) => {
      const wrap = $('#toastWrap');
      const el = document.createElement('div');
      el.className = 'fade-in rounded-xl bg-slate-900 text-white px-4 py-3 shadow-lg flex items-center gap-3';
      el.innerHTML = `<span>‚úÖ</span><span class="text-sm">${msg}</span>`;
      wrap.appendChild(el);
      setTimeout(()=>{ el.style.transition='opacity .2s'; el.style.opacity='0'; setTimeout(()=>el.remove(),220) }, 2200);
    };
    const timeAgo = (iso) => {
      const d = new Date(iso), s = Math.floor((Date.now() - d.getTime())/1000);
      if (s < 60) return 'Just now';
      const m = Math.floor(s/60); if (m < 60) return m + 'm';
      const h = Math.floor(m/60); if (h < 24) return h + 'h';
      const day = Math.floor(h/24); if (day < 7) return day + 'd';
      return d.toLocaleDateString();
    };

    // -------------- Data Access --------------
    function loadUsers(){ try { return JSON.parse(localStorage.getItem(USERS_KEY)) || []; } catch { return []; } }
    function saveUsers(users){ localStorage.setItem(USERS_KEY, JSON.stringify(users)); }
    function loadPosts(){ try { return JSON.parse(localStorage.getItem(POSTS_KEY)) || []; } catch { return []; } }
    function savePosts(posts){ localStorage.setItem(POSTS_KEY, JSON.stringify(posts)); }
    function getActiveUserId(){ return localStorage.getItem(ACTIVE_USER_KEY); }
    function setActiveUserId(id){ localStorage.setItem(ACTIVE_USER_KEY, id); }

    function getUser(id){ return loadUsers().find(u => u.id === id); }
    function getPost(id){ return loadPosts().find(p => p.id === id); }

    function seedIfEmpty() {
      if (loadUsers().length === 0) {
        const u1 = { id: 'u-ava', name: 'Ava Johnson', handle: 'ava', bio: 'Designer. Latte lover. ‚ú®', color: ['#3b82f6','#60a5fa'], following: ['u-max','u-zoe'], createdAt: nowISO() };
        const u2 = { id: 'u-max', name: 'Max Lee', handle: 'max', bio: 'Frontend, coffee, cats.', color: ['#22c55e','#14b8a6'], following: ['u-ava'], createdAt: nowISO() };
        const u3 = { id: 'u-zoe', name: 'Zoe Patel', handle: 'zoe', bio: 'Tech + travel + tea.', color: ['#a855f7','#ec4899'], following: ['u-ava','u-max'], createdAt: nowISO() };
        saveUsers([u1,u2,u3]);
        setActiveUserId('u-ava');

        const p1 = { id: genId('post'), authorId: 'u-ava', content: 'Sketching new ideas for a minimal dashboard. Loving soft shadows today!', createdAt: nowISO(), likes: ['u-max'], comments: [
          { id: genId('c'), authorId:'u-max', content:'Can‚Äôt wait to see it! üî•', createdAt: nowISO() }
        ]};
        const p2 = { id: genId('post'), authorId: 'u-max', content: 'Tabs vs Spaces? Drop your vote. üòÑ', createdAt: nowISO(), likes: ['u-ava','u-zoe'], comments: [] };
        const p3 = { id: genId('post'), authorId: 'u-zoe', content: 'Sunset run + lo-fi beats = focus unlocked.', createdAt: nowISO(), likes: [], comments: [] };
        const p4 = { id: genId('post'), authorId: 'u-ava', content: 'Trying Tailwind‚Äôs new color palette gradients ‚Äî chef‚Äôs kiss.', createdAt: nowISO(), likes: ['u-zoe'], comments: [
          { id: genId('c'), authorId:'u-zoe', content:'Share a sneak peek!', createdAt: nowISO() }
        ]};
        const p5 = { id: genId('post'), authorId: 'u-max', content: 'Hot tip: small animations make your UI feel alive ‚ú®', createdAt: nowISO(), likes: [], comments: [] };
        savePosts([p1,p2,p3,p4,p5]);
      }
      if (!getActiveUserId()) {
        const users = loadUsers();
        if (users[0]) setActiveUserId(users[0].id);
      }
    }

    // -------------- UI bits --------------
    function avatarSVG(user, size=40) {
      const [c1,c2] = user.color || ['#3b82f6','#60a5fa'];
      const initials = user.name.split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase();
      return `
        <svg width="${size}" height="${size}" viewBox="0 0 80 80" class="rounded-full shadow" aria-hidden="true">
          <defs>
            <linearGradient id="g-${user.id}" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="${c1}"/>
              <stop offset="100%" stop-color="${c2}"/>
            </linearGradient>
          </defs>
          <rect width="80" height="80" rx="40" fill="url(#g-${user.id})"></rect>
          <text x="50%" y="54%" text-anchor="middle" fill="white" font-size="30" font-weight="700" font-family="ui-sans-serif, system-ui">${initials}</text>
        </svg>
      `;
    }

    function followCounts(userId) {
      const users = loadUsers();
      const followers = users.filter(u => u.following.includes(userId)).length;
      const following = users.find(u => u.id === userId)?.following.length || 0;
      return { followers, following };
    }

    // -------------- Actions --------------
    function createPost(content) {
      const trimmed = (content || '').trim();
      if (!trimmed) return;
      const posts = loadPosts();
      posts.unshift({
        id: genId('post'),
        authorId: getActiveUserId(),
        content: trimmed,
        createdAt: nowISO(),
        likes: [],
        comments: []
      });
      savePosts(posts);
      toast('Posted!');
    }

    function toggleLike(postId) {
      const uid = getActiveUserId();
      const posts = loadPosts();
      const p = posts.find(x => x.id === postId);
      if (!p) return;
      const i = p.likes.indexOf(uid);
      if (i === -1) p.likes.push(uid); else p.likes.splice(i,1);
      savePosts(posts);
      return p.likes.includes(uid);
    }

    function addComment(postId, text) {
      const t = (text || '').trim();
      if (!t) return;
      const posts = loadPosts();
      const p = posts.find(x => x.id === postId);
      if (!p) return;
      p.comments.push({ id: genId('c'), authorId: getActiveUserId(), content: t, createdAt: nowISO() });
      savePosts(posts);
    }

    function isFollowing(targetId) {
      const me = getUser(getActiveUserId());
      return me?.following.includes(targetId);
    }

    function toggleFollow(targetId) {
      const uid = getActiveUserId();
      if (uid === targetId) return; // cannot follow yourself
      const users = loadUsers();
      const me = users.find(u => u.id === uid);
      const idx = me.following.indexOf(targetId);
      if (idx === -1) me.following.push(targetId); else me.following.splice(idx,1);
      saveUsers(users);
      toast(idx === -1 ? 'Followed' : 'Unfollowed');
    }

    function updateProfile(updates={}) {
      const users = loadUsers();
      const me = users.find(u => u.id === getActiveUserId());
      Object.assign(me, updates);
      saveUsers(users);
      toast('Profile updated');
    }

    // -------------- Render: shared post card --------------
    function renderPostCard(post) {
      const author = getUser(post.authorId);
      const meId = getActiveUserId();
      const liked = post.likes.includes(meId);
      const card = document.createElement('article');
      card.className = 'rounded-2xl bg-white shadow-soft hover:shadow-xl transition-shadow p-4 border border-slate-100/80';
      card.setAttribute('data-post-id', post.id);
      card.innerHTML = `
        <div class="flex gap-3">
          <a href="#profile/${author.id}" class="shrink-0" aria-label="${author.name}">${avatarSVG(author, 48)}</a>
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between gap-2">
              <div class="truncate">
                <a href="#profile/${author.id}" class="font-semibold hover:underline">${author.name}</a>
                <span class="text-slate-500">¬∑ @${author.handle} ¬∑ ${timeAgo(post.createdAt)}</span>
              </div>
              <a href="#post/${post.id}" class="text-slate-500 hover:text-slate-700 text-sm">Open</a>
            </div>
            <p class="mt-2 whitespace-pre-wrap">${post.content}</p>
            <div class="mt-3 flex items-center gap-3">
              <button data-like class="px-3 py-2 rounded-lg border ${liked ? 'bg-brand-600 text-white border-brand-600' : 'border-slate-300 hover:bg-slate-50'}">
                <span class="mr-1">${liked ? '‚ù§Ô∏è' : 'ü§ç'}</span><span data-like-count>${post.likes.length}</span>
              </button>
              <button data-toggle-comments class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">
                üí¨ <span class="ml-1" data-comment-count>${post.comments.length}</span>
              </button>
              ${author.id !== meId ? `
                <button data-follow="${author.id}" class="ml-auto px-3 py-2 rounded-lg ${isFollowing(author.id) ? 'bg-slate-200 text-slate-700' : 'bg-brand-600 text-white'}">
                  ${isFollowing(author.id) ? 'Following' : 'Follow'}
                </button>` : `
                <span class="ml-auto text-xs text-slate-500">You</span>
              `}
            </div>
            <div class="mt-3 hidden" data-comments-wrap>
              <div class="grid gap-3" data-comments-list>
                ${post.comments.slice(-3).map(c => {
                  const u = getUser(c.authorId) || {name:'User', handle:'user', id:'x', color:['#ddd','#ccc']};
                  return `
                    <div class="flex gap-3">
                      <a href="#profile/${u.id}" class="shrink-0">${avatarSVG(u,32)}</a>
                      <div class="flex-1 min-w-0">
                        <div class="text-sm"><a href="#profile/${u.id}" class="font-medium hover:underline">${u.name}</a> <span class="text-slate-500">@${u.handle} ¬∑ ${timeAgo(c.createdAt)}</span></div>
                        <div class="text-sm mt-1">${c.content}</div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
              <form data-comment-form class="mt-2 flex items-center gap-2">
                <input name="text" required maxlength="200" placeholder="Add a comment..." class="flex-1 rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-500 shadow-soft"/>
                <button type="submit" class="px-3 py-2 rounded-xl bg-brand-600 text-white hover:bg-brand-700 shadow-soft">Reply</button>
              </form>
            </div>
          </div>
        </div>
      `;

      // Like toggle (in-place update)
      const likeBtn = card.querySelector('[data-like]');
      likeBtn.addEventListener('click', () => {
        const nowLiked = toggleLike(post.id);
        const countEl = likeBtn.querySelector('[data-like-count]');
        const current = parseInt(countEl.textContent || '0', 10);
        countEl.textContent = (nowLiked ? current + 1 : current - 1);
        likeBtn.className = 'px-3 py-2 rounded-lg border ' + (nowLiked ? 'bg-brand-600 text-white border-brand-600' : 'border-slate-300 hover:bg-slate-50');
        likeBtn.querySelector('span').textContent = nowLiked ? '‚ù§Ô∏è' : 'ü§ç';
      });

      // Follow toggle
      const followBtn = card.querySelector('[data-follow]');
      if (followBtn) {
        followBtn.addEventListener('click', () => {
          const tid = followBtn.getAttribute('data-follow');
          toggleFollow(tid);
          // Update button state
          if (isFollowing(tid)) {
            followBtn.textContent = 'Following';
            followBtn.className = 'ml-auto px-3 py-2 rounded-lg bg-slate-200 text-slate-700';
          } else {
            followBtn.textContent = 'Follow';
            followBtn.className = 'ml-auto px-3 py-2 rounded-lg bg-brand-600 text-white';
          }
          // Refresh sidebar suggestions as it depends on follow state
          renderSuggestions();
        });
      }

      // Comment toggle
      const toggleC = card.querySelector('[data-toggle-comments]');
      const listWrap = card.querySelector('[data-comments-wrap]');
      const commentCountEl = card.querySelector('[data-comment-count]');
      toggleC.addEventListener('click', () => {
        listWrap.classList.toggle('hidden');
      });

      // Comment submit (re-render just comment list)
      const form = card.querySelector('[data-comment-form]');
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const text = new FormData(form).get('text');
        addComment(post.id, text);
        form.reset();
        // Re-render the comments list and count for this post
        const fresh = getPost(post.id);
        const list = card.querySelector('[data-comments-list]');
        list.innerHTML = fresh.comments.slice(-3).map(c => {
          const u = getUser(c.authorId);
          return `
            <div class="flex gap-3">
              <a href="#profile/${u.id}" class="shrink-0">${avatarSVG(u,32)}</a>
              <div class="flex-1 min-w-0">
                <div class="text-sm"><a href="#profile/${u.id}" class="font-medium hover:underline">${u.name}</a> <span class="text-slate-500">@${u.handle} ¬∑ ${timeAgo(c.createdAt)}</span></div>
                <div class="text-sm mt-1">${c.content}</div>
              </div>
            </div>
          `;
        }).join('');
        commentCountEl.textContent = fresh.comments.length;
      });

      return card;
    }

    // -------------- Pages --------------
    function renderFeed() {
      const me = getUser(getActiveUserId());
      const q = ($('#feedSearch')?.value || '').toLowerCase().trim();
      const filter = $('#feedFilter')?.value || 'all';
      const sort = $('#feedSort')?.value || 'latest';

      let posts = loadPosts().filter(p => p.authorId === me.id || me.following.includes(p.authorId));

      // Filter options
      if (filter === 'me') posts = posts.filter(p => p.authorId === me.id);
      if (filter === 'following') posts = posts.filter(p => p.authorId !== me.id);
      if (filter === 'liked') posts = posts.filter(p => p.likes.includes(me.id));

      // Search
      if (q) posts = posts.filter(p => {
        const u = getUser(p.authorId);
        return p.content.toLowerCase().includes(q) || u.name.toLowerCase().includes(q) || u.handle.toLowerCase().includes(q);
      });

      // Sort
      if (sort === 'latest') posts.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
      if (sort === 'top') posts.sort((a,b)=> b.likes.length - a.likes.length);

      const wrap = $('#feedList');
      wrap.innerHTML = '';
      // Quick post card
      const quick = document.createElement('div');
      quick.className = 'rounded-2xl bg-white shadow-soft p-4';
      quick.innerHTML = `
        <div class="flex gap-3">
          <div class="shrink-0">${avatarSVG(me, 44)}</div>
          <form id="quickPostForm" class="flex-1">
            <textarea rows="2" maxlength="280" name="text" class="w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-500" placeholder="Share something..."></textarea>
            <div class="mt-2 flex items-center justify-end">
              <button class="px-4 py-2 rounded-xl bg-brand-600 text-white hover:bg-brand-700">Post</button>
            </div>
          </form>
        </div>
      `;
      wrap.appendChild(quick);
      quick.querySelector('#quickPostForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const text = new FormData(e.currentTarget).get('text');
        createPost(text);
        e.currentTarget.reset();
        renderFeed();
      });

      // Posts
      if (posts.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'rounded-2xl bg-white shadow-soft p-8 text-center text-slate-600 border border-slate-100/80';
        empty.textContent = 'No posts yet. Follow people or create your first post!';
        wrap.appendChild(empty);
      } else {
        posts.forEach(p => wrap.appendChild(renderPostCard(p)));
      }

      renderSuggestions();
    }

    // Feed controls live update
    document.addEventListener('input', (e) => {
      if (e.target && (e.target.id === 'feedSearch')) renderFeed();
    });
    document.addEventListener('change', (e) => {
      if (e.target && (e.target.id === 'feedFilter' || e.target.id === 'feedSort')) renderFeed();
    });

    function renderSuggestions() {
      const me = getUser(getActiveUserId());
      const users = loadUsers().filter(u => u.id !== me.id && !me.following.includes(u.id)).slice(0, 5);
      const wrap = $('#suggestList');
      wrap.innerHTML = '';
      users.forEach(u => {
        const row = document.createElement('div');
        row.className = 'flex items-center justify-between gap-3';
        row.innerHTML = `
          <div class="flex items-center gap-3">
            <a href="#profile/${u.id}" class="shrink-0">${avatarSVG(u,36)}</a>
            <div>
              <a href="#profile/${u.id}" class="font-medium hover:underline">${u.name}</a>
              <div class="text-xs text-slate-500">@${u.handle}</div>
            </div>
          </div>
          <button class="px-3 py-1.5 rounded-lg bg-brand-600 text-white hover:bg-brand-700" data-suggest-follow="${u.id}">Follow</button>
        `;
        wrap.appendChild(row);
      });
      wrap.querySelectorAll('[data-suggest-follow]').forEach(btn => {
        btn.addEventListener('click', () => {
          toggleFollow(btn.getAttribute('data-suggest-follow'));
          renderFeed();
        });
      });
    }

    function renderExplore() {
      const q = ($('#exploreSearch')?.value || '').toLowerCase().trim();
      const posts = loadPosts().sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
      const users = loadUsers();
      const list = $('#exploreList');
      list.innerHTML = '';

      const filtered = q
        ? posts.filter(p => {
            const u = users.find(x => x.id === p.authorId);
            return p.content.toLowerCase().includes(q) || u.name.toLowerCase().includes(q) || u.handle.toLowerCase().includes(q);
          })
        : posts;

      filtered.forEach(p => list.appendChild(renderPostCard(p)));
      if (filtered.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'rounded-2xl bg-white shadow-soft p-8 text-center text-slate-600 border border-slate-100/80';
        empty.textContent = 'No results.';
        list.appendChild(empty);
      }
    }

    function renderUsers() {
      const meId = getActiveUserId();
      const users = loadUsers();
      const wrap = $('#usersList');
      wrap.innerHTML = '';
      users.forEach(u => {
        const {followers, following} = followCounts(u.id);
        const card = document.createElement('div');
        card.className = 'rounded-2xl bg-white shadow-soft hover:shadow-xl transition-shadow p-4 border border-slate-100/80 flex items-center gap-3';
        card.innerHTML = `
          <a href="#profile/${u.id}" class="shrink-0">${avatarSVG(u,56)}</a>
          <div class="flex-1 min-w-0">
            <a href="#profile/${u.id}" class="font-semibold hover:underline">${u.name}</a>
            <div class="text-sm text-slate-500">@${u.handle} ‚Ä¢ <span>${followers}</span> followers ¬∑ <span>${following}</span> following</div>
            <div class="text-sm text-slate-600 mt-1 clamp-2">${u.bio || ''}</div>
          </div>
          ${u.id === meId ? `<span class="text-xs text-slate-500">You</span>`
            : `<button data-follow="${u.id}" class="px-3 py-2 rounded-lg ${isFollowing(u.id) ? 'bg-slate-200 text-slate-700' : 'bg-brand-600 text-white'}">${isFollowing(u.id) ? 'Following' : 'Follow'}</button>`
          }
        `;
        wrap.appendChild(card);
      });
      wrap.querySelectorAll('[data-follow]').forEach(btn => {
        btn.addEventListener('click', () => {
          toggleFollow(btn.getAttribute('data-follow'));
          renderUsers();
        });
      });
    }

    function renderProfile(userId) {
      const meId = getActiveUserId();
      const user = getUser(userId || meId) || getUser(meId);
      const {followers, following} = followCounts(user.id);
      const header = document.createElement('div');
      header.className = 'rounded-2xl overflow-hidden shadow-soft bg-white border border-slate-100/80';
      header.innerHTML = `
        <div class="h-24 bg-gradient-to-r from-brand-600 to-brand-500"></div>
        <div class="-mt-10 px-6 pb-4">
          <div class="flex items-end justify-between">
            <div class="flex items-end gap-4">
              <div class="rounded-full ring-4 ring-white">${avatarSVG(user,80)}</div>
              <div>
                <div class="text-xl font-bold">${user.name}</div>
                <div class="text-slate-500">@${user.handle}</div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <div class="text-sm text-slate-600">${followers} followers ¬∑ ${following} following</div>
              ${user.id === meId ? `
                <button id="editProfileBtn" class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">Edit</button>
              ` : `
                <button id="pfFollowBtn" class="px-3 py-2 rounded-lg ${isFollowing(user.id) ? 'bg-slate-200 text-slate-700' : 'bg-brand-600 text-white'}">${isFollowing(user.id) ? 'Following' : 'Follow'}</button>
              `}
            </div>
          </div>
          <p class="mt-3 text-slate-700">${user.bio || ''}</p>
        </div>
      `;
      $('#profileHeader').innerHTML = '';
      $('#profileHeader').appendChild(header);

      const posts = loadPosts().filter(p => p.authorId === user.id).sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
      const list = $('#profilePosts');
      list.innerHTML = '';
      if (posts.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'rounded-2xl bg-white shadow-soft p-8 text-center text-slate-600 border border-slate-100/80';
        empty.textContent = 'No posts yet.';
        list.appendChild(empty);
      } else {
        posts.forEach(p => list.appendChild(renderPostCard(p)));
      }

      // Buttons
      const followBtn = $('#pfFollowBtn');
      if (followBtn) {
        followBtn.addEventListener('click', () => {
          toggleFollow(user.id);
          renderProfile(user.id);
        });
      }
      const editBtn = $('#editProfileBtn');
      if (editBtn) {
        editBtn.addEventListener('click', () => {
          // Simple inline edit
          const modal = document.createElement('div');
          modal.className = 'fixed inset-0 z-[60] bg-black/40 flex items-center justify-center p-4';
          modal.innerHTML = `
            <div class="relative w-full max-w-md rounded-2xl bg-white shadow-soft p-5 slide-up">
              <button class="abs-close absolute top-3 right-3 p-2 rounded-full hover:bg-slate-100">‚úï</button>
              <h3 class="text-lg font-bold">Edit profile</h3>
              <form class="mt-3 grid gap-3">
                <div>
                  <label class="block text-sm mb-1">Name</label>
                  <input name="name" value="${user.name}" class="w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-500"/>
                </div>
                <div>
                  <label class="block text-sm mb-1">Bio</label>
                  <textarea name="bio" rows="3" class="w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-500">${user.bio || ''}</textarea>
                </div>
                <div class="flex justify-end gap-2">
                  <button type="button" class="abs-close px-4 py-2 rounded-xl border border-slate-300 hover:bg-slate-50">Cancel</button>
                  <button type="submit" class="px-4 py-2 rounded-xl bg-brand-600 text-white hover:bg-brand-700">Save</button>
                </div>
              </form>
            </div>
          `;
          document.body.appendChild(modal);
          modal.querySelectorAll('.abs-close').forEach(b=>b.addEventListener('click',()=>modal.remove()));
          modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
          modal.querySelector('form').addEventListener('submit', (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.currentTarget).entries());
            updateProfile({ name: data.name, bio: data.bio });
            modal.remove();
            renderProfile(meId);
            renderHeaderUserSwitchers();
          });
        });
      }
    }

    function renderPostDetails(id) {
      const p = getPost(id);
      const wrap = $('#postDetails');
      wrap.innerHTML = '';
      if (!p) {
        const notFound = document.createElement('div');
        notFound.className = 'rounded-2xl bg-white shadow-soft p-6 text-center';
        notFound.innerHTML = `Post not found. <a href="#feed" class="text-brand-700 hover:underline">Go back</a>`;
        wrap.appendChild(notFound);
        return;
      }
      wrap.appendChild(renderPostCard(p));
      // Expand comments by default on detail
      const card = wrap.querySelector('[data-comments-wrap]');
      if (card) card.classList.remove('hidden');
    }

    // -------------- Router --------------
    function showPage(name) {
      ['feed','explore','users','profile','post'].forEach(n => {
        const el = document.getElementById('page-' + n);
        if (el) el.classList.add('hidden');
      });
      const el = document.getElementById('page-' + name);
      if (el) el.classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function parseHash() {
      const h = location.hash.slice(1) || 'feed';
      if (h.startsWith('profile/')) return { page: 'profile', id: h.split('/')[1] };
      if (h.startsWith('post/')) return { page: 'post', id: h.split('/')[1] };
      if (['feed','explore','users','profile'].includes(h)) return { page: h };
      return { page: 'feed' };
    }

    function renderRoute() {
      const {page, id} = parseHash();
      if (page === 'feed') { showPage('feed'); renderFeed(); }
      else if (page === 'explore') { showPage('explore'); renderExplore(); }
      else if (page === 'users') { showPage('users'); renderUsers(); }
      else if (page === 'profile') { showPage('profile'); renderProfile(id); }
      else if (page === 'post') { showPage('post'); renderPostDetails(id); }
    }

    // -------------- Header user switchers --------------
    function renderHeaderUserSwitchers() {
      const users = loadUsers();
      const activeId = getActiveUserId();
      const selects = [$('#activeUserSelect'), $('#activeUserSelectMobile')].filter(Boolean);
      selects.forEach(sel => {
        sel.innerHTML = users.map(u => `<option value="${u.id}" ${u.id===activeId?'selected':''}>${u.name} (@${u.handle})</option>`).join('');
        sel.onchange = () => {
          setActiveUserId(sel.value);
          toast('Switched user');
          renderRoute();
        };
      });
    }

    // -------------- Events --------------
    window.addEventListener('hashchange', renderRoute);

    // Mobile menu
    $('#mobileMenuBtn').addEventListener('click', () => {
      $('#mobileMenu').classList.toggle('hidden');
    });

    // Composer
    function openComposer(){ $('#composerModal').classList.remove('hidden'); $('#composerText').focus(); }
    function closeComposer(){ $('#composerModal').classList.add('hidden'); $('#composerForm').reset(); $('#charCount').textContent = '0'; }
    $('#openComposer').addEventListener('click', openComposer);
    $('#openComposerMobile').addEventListener('click', () => { openComposer(); $('#mobileMenu').classList.add('hidden'); });
    $('#closeComposer').addEventListener('click', closeComposer);
    $('#composerModal').addEventListener('click', (e)=>{ if (e.target.id === 'composerModal') closeComposer(); });
    $('#composerText').addEventListener('input', (e)=> $('#charCount').textContent = e.target.value.length);
    $('#composerForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const text = $('#composerText').value;
      createPost(text);
      closeComposer();
      renderRoute();
    });

    // Explore live search
    $('#exploreSearch').addEventListener('input', renderExplore);

    // -------------- Init --------------
    seedIfEmpty();
    renderHeaderUserSwitchers();
    renderRoute();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98290ed107fedcf0',t:'MTc1ODQ1MjQxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
